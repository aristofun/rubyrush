# Хранение данных, SQLite 

 Мы добрались до самого важного и популярного способа хранить данные ­— базы данных (БД). Базы данных — отдельная тема и целая специализация, о которой можно сделать пару отдельных курсов.

В следующих двух уроках мы дадим вам лишь самые основы на простых примерах, чтобы при необходимости вы дальше смогли сами разобраться. Итак:

### План урока
1. Что такое базы данных (БД) и SQL-запросы
2. Какие бывают системы управления базами данных (СУБД)
3. SQLite
4. Наша первая БД


<!-- youtube starts here -->
<script>
var videoPlan = {}
</script>

<div class="embed-responsive embed-responsive-16by9 rubyrush-video" id="video-0">
<iframe src="https://www.youtube.com/embed/2SeOx4XshuY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<script>
videoPlan["video-0"] = [{"begin":"0:06","comment":"Приветствие и план урока"},{"begin":"0:54","comment":"Что такое база данных и зачем она нужна"},{"begin":"3:58","comment":"Реляционные базы данных"},{"begin":"5:46","comment":"Как устроена SQL база данных"}]
</script>
</div>


<div class="embed-responsive embed-responsive-16by9 rubyrush-video" id="video-1">
<iframe src="https://www.youtube.com/embed/c6_1HtydN08" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<script>
videoPlan["video-1"] = [{"begin":"0:04","comment":"Установка SQLite на Windows "},{"begin":"0:29","comment":"Установка DevKit на Windows "},{"begin":"2:31","comment":"Установка SQLite на Windows "},{"begin":"5:26","comment":"Установка SQLite Manager для Firefox "},{"begin":"6:23","comment":"Основы языка SQL"},{"begin":"8:11","comment":"Создаем свою первую базу SQLite"},{"begin":"13:17","comment":"Итоги урока "}]
</script>
</div>

 <!-- youtube ends here --> 

### Что такое базы данных (БД)

Можно было бы, конечно, хранить данные просто в файликах, тем более, что теперь мы знаем такие замечательные форматы как XML и JSON. Чего же не хватало программистам, зачем нужно было создавать ещё один способ хранения данных.

Если совсем просто, то база данных — это собственно, информация, которую могут использовать в своей работе программы. Строго говоря, наши XML-файлики, которые мы использовали в предыдущих уроках — это тоже базы данных, но только очень простые.

Более серьезные базы данных обладают специальной программой, которая сама «раздает» и «собирает» данные: системой управления. Система управление — это специальная программа которая хранит ваши данные особым образом.

Представьте себе два типа магазина: огромный склад, где всё лежит, как попало, отсортированное кем-то однажды, в огромных штабелях. Вам приходится самому лазить по ним, искать, что нужно и смотреть, как бы вас там всем этим не завалило. А потом тащить на кассу, оплачивать и тащить домой. Как-то так можно представить себе работу с файликами.

А работа с базой данных — это заказ в удобном интернет-магазине с доставкой. Вы говорите, что вам надо, а заботливые сотрудники сами всё доставляют и привозят в лучшем виде.

У использования баз данных следующие преимущества:

  * Удобство поиска
  * Конфиденциальность, разделение доступа
  * Оптимизация времени (поиск, сортировка результатов)
  * Распределённость, многопоточность

### Какие бывают системы управления базами данных (СУБД)

[СУБД](https://ru.wikipedia.org/wiki/%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0_%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F_%D0%B1%D0%B0%D0%B7%D0%B0%D0%BC%D0%B8_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85) — это системы, которые фактически, исполняют ваши запросы к базе данных. Например, вы хотите узнать количество людей на планете Земля. Если бы у нас была подходящая база данных, мы могли бы сказать ей:

```sql
НАЙДИ всех ЛЮДЕЙ, которые живут на планете "Земля" и ПОКАЖИ их количество
```

*(заглавными буквами выделены ключевые слова, чтобы придать этой фразе вид компьютерного запроса, хотя в реальности запросы выглядят немного иначе)*.

Базы данных бывают очень разные для разных задач: они могут отличаться способом хранения данных, способом получения данных, возможными функциями и так далее. Важнейший для программиста параметр — способ получения данных или, другими словами, «язык запросов».

### SQL — structured query language

Самый распространенный сейчас язык запросов — [SQL](https://ru.wikipedia.org/wiki/SQL). Это специальный язык, на котором базы разговаривают с внешним миром. Вот самые популярные базы, система управления которых использует SQL: [MySQL](https://ru.wikipedia.org/wiki/MySQL), [PostgreSQL](https://ru.wikipedia.org/wiki/PostgreSQL), [sqlite](https://ru.wikipedia.org/wiki/SQLite), [Oracle](https://ru.wikipedia.org/wiki/Oracle).

Сейчас мы на примере самой простой из них (**sqlite**) рассмотрим основные идеи и разберем основные команды SQL для создания и чтения данных. Кстати, именно эта БД используется для хранения данных в вашем смартфонах на айос или андроид, и поэтому можно смело сказать, что эта система управления базами одна из самых популярных.

### Как устроена база данных внутри?

Данные в базах структурированы в виде таблиц, почти как в Экселе. Каждая таблица обычно соответствует какой-то одной сущности, например таблица «Люди» (`people`) может представлять собой список с информацией о людях. Строка таблицы содержит информацию о единице сущности: имя, пол, возраст. У каждого столбца есть название (`name`, `sex`, `age`) и тип (строка, целое число, булевский тип и т.д.).

Для того, чтобы к любой строке в любой таблице можно было обратиться, однозначно её идентифицировав, у каждой строки есть строго уникальное поле `ID`. Это столбец, содержащий «айдишники», он может называться по-разному, но суть одна — это уникальный идентификатор, который, как правило, записан в виде целого числа (для первой строки 1, для второй — 2 и т.д.). Чтобы всегда можно было однозначно обратиться к нужной строке, этот ID неизменен, то есть, если первую строку из таблицы удалить, ID второй строки всё равно останется 2. А третья строка добавится с ID равным 3.

### Связи в БД, реляционные БД

Также ID-шники используются для того, чтобы создавать связи между таблицами. Допустим, у нас есть таблица людей `people` и таблица компаний `companies`. Тогда мы можем прописать у каждого человека в поле `company_id` идентификатор компании, в которой он работает и таким образом отобразить, какую строку из таблицы `companies` нужно достать, если мы хотим узнать о месте работы конкретного `person`.

![Связи в реляционной БД](http://goodprogrammer.ru/system/rich_texts/000/000/4369a3206d3555dd99405f9b47645a9fc63037fc0c2/01-sql-relations-for-text.png?1441308247 "Связи в реляционной БД")

Совокупность таблиц и связей между ними — это модель данных. Связи играют важную роль, это отражено в названии: SQL-базы относятся к категории «реляционных». Связи ускоряют доступ к данным и помогают сохранять порядок в базе.

### Установка Dev-Kit

Для того, чтобы создать нашу первую базу данных, нам необходимо немного подготовиться. Для начала, давайте установим специальный пакет разработчика, который можно скачать с сайта [установщика руби](http://rubyinstaller.org/downloads/).

![Качаем DevKit с сайта rubyinstaller.org](http://goodprogrammer.ru/system/rich_texts/000/000/4387e24c1d90afca0da29eaad0007412d234eabb402/03-devkit-for-text.png?1441308247 "Качаем DevKit с сайта rubyinstaller.org")

Если у вас не установлен архиватор 7zip, его можно скачать бесплатного с сайта [7zip](http://www.7-zip.org/). После скачивания, распаковываем архив в папку `с:\dev`.

![Установка DevKit](http://goodprogrammer.ru/system/rich_texts/000/000/43922233cf8fc551c3a832ac57b73ac41395c50aa87/04-devkit-installation-for-text.png?1441308247 "Установка DevKit")

И, наконец, устанавливаем пакет с утилитами в систему: для этого необходимо зайти в папку `с:\dev` в консоли и запустить установку:

```sh
cd c:\dev
ruby dk.rb init
ruby dk.rb install
```

![Установка SQLITE для Windows](http://goodprogrammer.ru/system/rich_texts/000/000/367b4c2714080a42aa688c758a2b79704ddd4ba806a/05-sqlite-autoconf-for-text.png?1440876805 "Установка SQLITE для Windows")

Теперь у нас в системе есть инструмент для сборки более низкоуровневых программ, написанных на языке C/C++. Нам он пригодиться для сборки и установки sqlite.

### Установка sqlite

Для этого нам необходимо скачать с сайта [sqlite.org](http://sqlite.org) архив, в названии которого есть слово `autoconf`. На всякий случай вот прямая [ссылка](http://sqlite.org/2015/sqlite-autoconf-3081101.tar.gz) на версию 3.8.11.1. Вы также можете найти этот архив в материалах к уроку.

Для простоты дальнейшей работы распакуйте (можно всё тем же [7zip](http://www.7-zip.org/)) архив, переименуйте получившуюся папку в `sqlite` и перенесите в корень, на диск `c:\` .

Пришло время установить sqlite. Запустите файл `msys.bat`, который лежит в папке `c:\dev`, куда вы (надеюсь) распаковали наш Dev-Kit. Это специальная консоль, в которой доступно немного больше команд, чем в обычной.

![Запускаем msys.bat](http://goodprogrammer.ru/system/rich_texts/000/000/440e6f7549d19435019cd6452d00a29f4ade5c9ab67/05-msys.bat-for-text.png?1441308247 "Запускаем msys.bat")

Перейдите в консоли в папку `sqlite` и установите sqlite

```sh
cd c:\sqlite
./configure
make
make install
```

Если всё прошло гладко и никаких ошибок не возникло, в вашей системе установлен sqlite! Поздравляем!

### Установка SQLite Manager

У нас на компьютере установлена база SQlite, но для того, чтобы с ней работать нам нужен ещё любой клиент. Давайте скачаем один из самых простых и лёгких в настройке: плагин для браузера FireFox (если у вас ещё нет этого браузера — [скачайте скорее](https://www.mozilla.org/en-US/firefox/new/)).

Итак, устанавливаем [SQLite Manager](https://addons.mozilla.org/en-US/firefox/addon/sqlite-manager/) для Firefox. Это довольно просто.

![Установка SQLite Manager для FireFox](http://goodprogrammer.ru/system/rich_texts/000/000/441feede0c7819d202196ca9f6066f5a887898783d0/06-sqlite-manager-for-text.png?1441308247 "Установка SQLite Manager для FireFox")

### Язык SQL — кратко

Когда мы открывали файлы, мы сами руками выбирали как формат, в котором мы будем в них писать (либо просто текст, либо используя XML-парсер или конвертируя данные в JSON-текст), в базе данных мы ничего не пишем напрямую, мы формулируем базе свои желания в виде запросов. Вернее, в виде SQL-запросов.

Язык SQL-запросов — это отдельный язык со своим синтаксисом. Например, чтобы попросить базу вернуть нам все записи из таблицы `people`, нам нужно сформировать такой запрос:

```sql
SELECT * FROM people;
```

А чтобы добавить запись о компании Google в таблицу `companies`, нужно сформировать вот такой запрос:

```sql
INSERT INTO companies VALUES (`Google`);
```

Обратите внимание, все запросы завершаются знаком точки с запятой. Чуть больше о запросах мы узнаем на практике.

### Создаём первую БД

Запустите плагин и создайте новую базу. Он предложит сохранить её где-нибудь на диске. Сохраните, например, в папке урока `c:\rubytut2\lesson11\hellow_world.sqlite`.

Создайте таблицу людей:

![Наша первая таблица people](http://goodprogrammer.ru/system/rich_texts/000/000/4422cd08e5ddd8c892e57b239ea1fde602608b9acb9/07-first-db-for-text.png?1441308248 "Наша первая таблица people")

Обратите внимание, что при создании таблицы SQlite Manager показал нам запрос, который отправляется для создания этой таблицы. Да, для того, чтобы создавать таблицы (а в некоторых СУБД даже для создания баз данных) также используются SQL-запросы.

```sql
CREATE TABLE "main"."people" ("name" TEXT, "phone" TEXT, "birthday" DAYTIME);
```

Создайте в вашей новой БД запись. Для этого во вкладке `Выполнить запрос` напишите INSERT-запрос:

```sql
INSERT INTO people VALUES ('Вадик', '+7 926 982-58-19', '1984-09-14 03:00:00');
```

Теперь в вашей новой таблице есть даже одна строка. Обратите внимание на поле `rowid` — это тот самый уникальный идентификатор, о котором мы говорили. В SQlite он называется rowid.

![Добавим одну строчку в БД](http://goodprogrammer.ru/system/rich_texts/000/000/44347d065e9469ede91e99824024c6b7e7ebe25a547/08-db-row-for-text.png?1441308248 "Добавим одну строчку в БД")

### Философия БД

Базы данных — это отдельная вселенная. Ни одно современное приложение не обходится без базы данных, а в разделе вакансий для программистов всегда есть подраздел: программисты баз данных. Но даже если вы не планируете связать вашу жизнь с программированием баз данных, хороший программист должен знать основы и уметь использовать БД для решения своих задач.

Сейчас мы просто узнали, что такое БД и создали одну на пробу. А в следующем уроке мы подключим нашу СУБД к нашему блокноту на Ruby и будем хранить наши записи в SQlite-базе.
